"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/message/websocket";
exports.ids = ["pages/api/message/websocket"];
exports.modules = {

/***/ "mysql2":
/*!*************************!*\
  !*** external "mysql2" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("mysql2");

/***/ }),

/***/ "ua-parser-js":
/*!*******************************!*\
  !*** external "ua-parser-js" ***!
  \*******************************/
/***/ ((module) => {

module.exports = require("ua-parser-js");

/***/ }),

/***/ "socket.io":
/*!****************************!*\
  !*** external "socket.io" ***!
  \****************************/
/***/ ((module) => {

module.exports = import("socket.io");;

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("fs");

/***/ }),

/***/ "(api)/./database/index.js":
/*!***************************!*\
  !*** ./database/index.js ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"executeQuery\": () => (/* binding */ executeQuery)\n/* harmony export */ });\nconst { createPool  } = __webpack_require__(/*! mysql2 */ \"mysql2\");\nconst pool = createPool({\n    host: process.env.DB_HOST,\n    user: process.env.DB_USER,\n    password: process.env.DB_PASSWORD,\n    port: process.env.DB_PORT,\n    database: process.env.DB_DATABASE,\n    connectionLimit: 30\n});\npool.getConnection((err, connection)=>{\n    if (err) {\n        console.log(\"error connect to db..\" + process.env.DB_HOST);\n    // setTimeout(function() { pool.getConnection(); }, 2500);\n    }\n    console.log(\"[DB 연결 성공] : \" + process.env.DB_HOST);\n    connection.release();\n});\nconst executeQuery = (query, arrParams)=>{\n    return new Promise((resolve, reject)=>{\n        try {\n            pool.query(query, arrParams, (err, data)=>{\n                if (err) {\n                    reject(err);\n                }\n                resolve(data);\n            });\n        } catch (err) {\n            reject(err);\n        }\n    });\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9kYXRhYmFzZS9pbmRleC5qcy5qcyIsIm1hcHBpbmdzIjoiOzs7O0FBQUEsTUFBTSxFQUFDQSxXQUFVLEVBQUMsR0FBR0MsbUJBQU9BLENBQUM7QUFDN0IsTUFBTUMsT0FBT0YsV0FBVztJQUN0QkcsTUFBS0MsUUFBUUMsR0FBRyxDQUFDQyxPQUFPO0lBQ3hCQyxNQUFLSCxRQUFRQyxHQUFHLENBQUNHLE9BQU87SUFDeEJDLFVBQVNMLFFBQVFDLEdBQUcsQ0FBQ0ssV0FBVztJQUNoQ0MsTUFBS1AsUUFBUUMsR0FBRyxDQUFDTyxPQUFPO0lBQ3hCQyxVQUFTVCxRQUFRQyxHQUFHLENBQUNTLFdBQVc7SUFDaENDLGlCQUFpQjtBQUNuQjtBQUVBYixLQUFLYyxhQUFhLENBQUMsQ0FBQ0MsS0FBS0MsYUFBZTtJQUN0QyxJQUFHRCxLQUFJO1FBQ0xFLFFBQVFDLEdBQUcsQ0FBQywwQkFBMEJoQixRQUFRQyxHQUFHLENBQUNDLE9BQU87SUFDekQsMERBQTBEO0lBQzVELENBQUM7SUFDRGEsUUFBUUMsR0FBRyxDQUFDLGtCQUFrQmhCLFFBQVFDLEdBQUcsQ0FBQ0MsT0FBTztJQUNqRFksV0FBV0csT0FBTztBQUNwQjtBQUVPLE1BQU1DLGVBQWUsQ0FBQ0MsT0FBT0MsWUFBYztJQUNoRCxPQUFPLElBQUlDLFFBQVEsQ0FBQ0MsU0FBU0MsU0FBUztRQUNwQyxJQUFHO1lBQ0R6QixLQUFLcUIsS0FBSyxDQUFDQSxPQUFPQyxXQUFXLENBQUNQLEtBQUtXLE9BQVE7Z0JBQ3pDLElBQUdYLEtBQUk7b0JBQ0xVLE9BQU9WO2dCQUNULENBQUM7Z0JBQ0RTLFFBQVFFO1lBQ1Y7UUFDRixFQUFFLE9BQU9YLEtBQUk7WUFDWFUsT0FBT1Y7UUFDVDtJQUNGO0FBQ0YsRUFBQyIsInNvdXJjZXMiOlsid2VicGFjazovL2pvb3RvbmcvLi9kYXRhYmFzZS9pbmRleC5qcz8yZWMzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IHtjcmVhdGVQb29sfSA9IHJlcXVpcmUoJ215c3FsMicpO1xyXG5jb25zdCBwb29sID0gY3JlYXRlUG9vbCh7XHJcbiAgaG9zdDpwcm9jZXNzLmVudi5EQl9IT1NULFxyXG4gIHVzZXI6cHJvY2Vzcy5lbnYuREJfVVNFUixcclxuICBwYXNzd29yZDpwcm9jZXNzLmVudi5EQl9QQVNTV09SRCxcclxuICBwb3J0OnByb2Nlc3MuZW52LkRCX1BPUlQsXHJcbiAgZGF0YWJhc2U6cHJvY2Vzcy5lbnYuREJfREFUQUJBU0UsXHJcbiAgY29ubmVjdGlvbkxpbWl0OiAzMFxyXG59KVxyXG5cclxucG9vbC5nZXRDb25uZWN0aW9uKChlcnIsIGNvbm5lY3Rpb24pID0+IHtcclxuICBpZihlcnIpe1xyXG4gICAgY29uc29sZS5sb2coJ2Vycm9yIGNvbm5lY3QgdG8gZGIuLicgKyBwcm9jZXNzLmVudi5EQl9IT1NUKVxyXG4gICAgLy8gc2V0VGltZW91dChmdW5jdGlvbigpIHsgcG9vbC5nZXRDb25uZWN0aW9uKCk7IH0sIDI1MDApO1xyXG4gIH1cclxuICBjb25zb2xlLmxvZygnW0RCIOyXsOqysCDshLHqs7VdIDogJyArIHByb2Nlc3MuZW52LkRCX0hPU1QpXHJcbiAgY29ubmVjdGlvbi5yZWxlYXNlKCk7XHJcbn0pXHJcblxyXG5leHBvcnQgY29uc3QgZXhlY3V0ZVF1ZXJ5ID0gKHF1ZXJ5LCBhcnJQYXJhbXMpID0+IHtcclxuICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCk9PntcclxuICAgIHRyeXtcclxuICAgICAgcG9vbC5xdWVyeShxdWVyeSwgYXJyUGFyYW1zLCAoZXJyLCBkYXRhKSA9PntcclxuICAgICAgICBpZihlcnIpe1xyXG4gICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJlc29sdmUoZGF0YSlcclxuICAgICAgfSlcclxuICAgIH0gY2F0Y2ggKGVycil7XHJcbiAgICAgIHJlamVjdChlcnIpXHJcbiAgICB9XHJcbiAgfSlcclxufSJdLCJuYW1lcyI6WyJjcmVhdGVQb29sIiwicmVxdWlyZSIsInBvb2wiLCJob3N0IiwicHJvY2VzcyIsImVudiIsIkRCX0hPU1QiLCJ1c2VyIiwiREJfVVNFUiIsInBhc3N3b3JkIiwiREJfUEFTU1dPUkQiLCJwb3J0IiwiREJfUE9SVCIsImRhdGFiYXNlIiwiREJfREFUQUJBU0UiLCJjb25uZWN0aW9uTGltaXQiLCJnZXRDb25uZWN0aW9uIiwiZXJyIiwiY29ubmVjdGlvbiIsImNvbnNvbGUiLCJsb2ciLCJyZWxlYXNlIiwiZXhlY3V0ZVF1ZXJ5IiwicXVlcnkiLCJhcnJQYXJhbXMiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsImRhdGEiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./database/index.js\n");

/***/ }),

/***/ "(api)/./pages/api/message/websocket.js":
/*!****************************************!*\
  !*** ./pages/api/message/websocket.js ***!
  \****************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var _database_index__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! #database/index */ \"(api)/./database/index.js\");\n/* harmony import */ var socket_io__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! socket.io */ \"socket.io\");\n/* harmony import */ var _utils_getTime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! #utils/getTime */ \"(api)/./utils/getTime.js\");\n/* harmony import */ var _utils_randomUUID__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! #utils/randomUUID */ \"(api)/./utils/randomUUID.js\");\n/* harmony import */ var ua_parser_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ua-parser-js */ \"ua-parser-js\");\n/* harmony import */ var ua_parser_js__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(ua_parser_js__WEBPACK_IMPORTED_MODULE_4__);\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([socket_io__WEBPACK_IMPORTED_MODULE_1__]);\nsocket_io__WEBPACK_IMPORTED_MODULE_1__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\nconst fs = __webpack_require__(/*! fs */ \"fs\");\n\nlet todayImageFolder = false;\nconst SocketHandler = (req, res)=>{\n    if (res.socket.server.io) {\n        const userInfo = ua_parser_js__WEBPACK_IMPORTED_MODULE_4___default()(req.headers[\"user-agent\"]);\n        const ip = req.clientIp;\n        console.log(\"Socket is already running\", ip, userInfo.os, userInfo.browser, userInfo.device);\n    } else {\n        const userInfo1 = ua_parser_js__WEBPACK_IMPORTED_MODULE_4___default()(req.headers[\"user-agent\"]);\n        const ip1 = req.clientIp;\n        console.log(\"Socket is conncet :\", ip1, userInfo1.os, userInfo1.browser, userInfo1.device);\n        const io = new socket_io__WEBPACK_IMPORTED_MODULE_1__.Server(res.socket.server);\n        res.socket.server.io = io;\n        io.of(req.query.namespace).on(\"connection\", (socket)=>{\n            const count = io.of(\"/\").sockets.size;\n            console.log(\"count :\", count);\n            io.of(req.query.namespace).emit(\"count\", count);\n            socket.on(\"privateConnect\", function(user_key) {\n                socket.join(user_key);\n            });\n            socket.on(\"joinRoom\", async function(roomId) {\n                socket.join(roomId);\n                await (0,_database_index__WEBPACK_IMPORTED_MODULE_0__.executeQuery)(\"SELECT * FROM room WHERE room_id = ?\", [\n                    roomId\n                ]).then((resultRoomInfo)=>{\n                    io.to(roomId).emit(\"roomInfo\", resultRoomInfo[0]);\n                });\n            });\n            socket.on(\"joinPrivateRoom\", function(roomId) {\n                socket.join(roomId);\n            });\n            socket.on(\"reJoinPrivateRoom\", async function(data) {\n                await (0,_database_index__WEBPACK_IMPORTED_MODULE_0__.executeQuery)(\"SELECT count(*) count FROM private_room WHERE create_nickname = ? OR target_nickname = ? \", [\n                    data.nickname,\n                    data.nickname\n                ]).then(async (result)=>{\n                    if (result[0].count < 5) {\n                        if (data.target === \"target\") {\n                            await (0,_database_index__WEBPACK_IMPORTED_MODULE_0__.executeQuery)(\"UPDATE private_room SET target_nickname = ? WHERE room_id = ?\", [\n                                data.nickname,\n                                data.room_id\n                            ]).then(async function(result) {\n                                if (typeof result.affectedRows === \"number\") {\n                                    await (0,_database_index__WEBPACK_IMPORTED_MODULE_0__.executeQuery)(\"SELECT * FROM private_message WHERE room_id = ?\", [\n                                        data.room_id\n                                    ]).then((list)=>{\n                                        socket.join(data.room_id);\n                                        data.messageList = list;\n                                        io.to(data.room_id).emit(\"reJoinPrivateRoom\", data);\n                                    });\n                                }\n                            });\n                        } else {\n                            await (0,_database_index__WEBPACK_IMPORTED_MODULE_0__.executeQuery)(\"UPDATE private_room SET create_nickname = ? WHERE room_id = ?\", [\n                                data.nickname,\n                                data.room_id\n                            ]).then(async function(result) {\n                                if (typeof result.affectedRows === \"number\") {\n                                    await (0,_database_index__WEBPACK_IMPORTED_MODULE_0__.executeQuery)(\"SELECT * FROM private_message WHERE room_id = ?\", [\n                                        data.room_id\n                                    ]).then((list)=>{\n                                        socket.join(data.room_id);\n                                        data.messageList = list;\n                                        io.to(data.room_id).emit(\"reJoinPrivateRoom\", data);\n                                    });\n                                }\n                            });\n                        }\n                    } else {\n                        io.to(data.user_key).emit(\"createPrivateRoomResult\", {\n                            status: false,\n                            message: \"[⚠️1:1 채팅방 개설 오류] 1:1 채팅방 참여 개수(5) 를 초과하였습니다.\"\n                        });\n                    }\n                });\n            });\n            socket.on(\"deleteRoom\", async function(data) {\n                await (0,_database_index__WEBPACK_IMPORTED_MODULE_0__.executeQuery)(\"SELECT * FROM room WHERE room_id = ?\", [\n                    data.roomId\n                ]).then(async (result)=>{\n                    if (result[0].create_user_key === data.user_key) {\n                        await (0,_database_index__WEBPACK_IMPORTED_MODULE_0__.executeQuery)(\"DELETE FROM room, message USING room INNER JOIN message ON room.room_id = message.room_id WHERE room.room_id = ?\", [\n                            result[0].room_id\n                        ]).then(async (deleteResult)=>{\n                            if (deleteResult.affectedRows) {\n                                io.to(data.roomId).emit(\"deleteRoom\", result);\n                            }\n                        });\n                    } else {\n                        io.to(data.nickname).emit(\"deleteRoom\", {\n                            user_key: data.user_key,\n                            message: \"삭제 권한이 없습니다.\"\n                        });\n                    }\n                });\n            });\n            socket.on(\"deletePrivateRoom\", async function(data) {\n                await (0,_database_index__WEBPACK_IMPORTED_MODULE_0__.executeQuery)(\"UPDATE private_room SET create_nickname = REPLACE(create_nickname, ?, ''), target_nickname = REPLACE(target_nickname, ?, '') WHERE room_id = ?\", [\n                    data.nickname,\n                    data.nickname,\n                    data.room_id\n                ]).then(async function(result) {\n                    if (typeof result.affectedRows === \"number\") {\n                        io.to(data.room_id).emit(\"deletePrivateRoom\", data);\n                        io.to(data.user_key).emit(\"deletePrivateRoom\", data);\n                        await (0,_database_index__WEBPACK_IMPORTED_MODULE_0__.executeQuery)(\"SELECT room_id, create_nickname, target_nickname FROM private_room WHERE room_id = ?\", [\n                            data.room_id\n                        ]).then(async function(result) {\n                            if (result[0].create_nickname === \"\" && result[0].target_nickname === \"\") {\n                                await (0,_database_index__WEBPACK_IMPORTED_MODULE_0__.executeQuery)(\"DELETE FROM private_room, private_message USING private_room INNER JOIN private_message ON private_room.room_id = private_message.room_id WHERE private_room.room_id = ?\", [\n                                    result[0].room_id\n                                ]).then(()=>{\n                                    console.log(\"[private data delete complete when room_id] =\", result[0].room_id);\n                                });\n                            }\n                        });\n                    }\n                });\n            });\n            socket.on(\"lobbyMessage\", async function(data) {\n                data.send_date = (0,_utils_getTime__WEBPACK_IMPORTED_MODULE_2__.getTime)();\n                io.of(req.query.namespace).emit(\"getLobbyMessage\", data);\n            });\n            socket.on(\"roomMessageSend\", async function(data) {\n                if (!data.image && !data.text) return false;\n                data.send_date = (0,_utils_getTime__WEBPACK_IMPORTED_MODULE_2__.getTime)();\n                await (0,_database_index__WEBPACK_IMPORTED_MODULE_0__.executeQuery)(\"INSERT INTO message(room_id, nickname, user_key, text, image, send_date) values (?, ?, ?, ?, ?, ?)\", [\n                    data.room_id,\n                    data.nickname,\n                    data.user_key,\n                    data.text,\n                    data.image,\n                    data.send_date\n                ]).then(async function(result) {\n                    if (result.affectedRows) {\n                        io.to(data.room_id).emit(\"roomMessage\", data);\n                    }\n                });\n            });\n            socket.on(\"privateMessageSend\", async function(data) {\n                if (!data.image && !data.text) return false;\n                data.send_date = (0,_utils_getTime__WEBPACK_IMPORTED_MODULE_2__.getTime)();\n                await (0,_database_index__WEBPACK_IMPORTED_MODULE_0__.executeQuery)(\"INSERT INTO private_message(room_id, nickname, user_key, text, image, send_date) values (?, ?, ?, ?, ?, ?)\", [\n                    data.room_id,\n                    data.nickname,\n                    data.user_key,\n                    data.text,\n                    data.image,\n                    data.send_date\n                ]).then(async function(result) {\n                    if (result.affectedRows) {\n                        if (data.isCreateUser) {\n                            await (0,_database_index__WEBPACK_IMPORTED_MODULE_0__.executeQuery)(\"UPDATE private_room SET last_date=?, last_nickname=?, last_text=?, last_create_user =? WHERE room_id=?\", [\n                                data.send_date,\n                                data.nickname,\n                                data.text,\n                                data.send_date,\n                                data.room_id\n                            ]).then(function(result) {\n                                if (result.affectedRows) {\n                                    io.to(data.room_id).emit(\"privateMessage\", data);\n                                    io.to(data.target_user_key).emit(\"updateNewMessage\", {\n                                        data,\n                                        user_key: data.user_key\n                                    });\n                                    io.to(data.user_key).emit(\"updateNewMessage\", {\n                                        data,\n                                        user_key: data.user_key\n                                    });\n                                }\n                            });\n                        } else {\n                            await (0,_database_index__WEBPACK_IMPORTED_MODULE_0__.executeQuery)(\"UPDATE private_room SET last_date=?, last_nickname=?, last_text=?, last_target_user =? WHERE room_id=?\", [\n                                data.send_date,\n                                data.nickname,\n                                data.text,\n                                data.send_date,\n                                data.room_id\n                            ]).then(function(result) {\n                                if (result.affectedRows) {\n                                    io.to(data.room_id).emit(\"privateMessage\", data);\n                                    io.to(data.target_user_key).emit(\"updateNewMessage\", {\n                                        data,\n                                        user_key: data.user_key\n                                    });\n                                    io.to(data.user_key).emit(\"updateNewMessage\", {\n                                        data,\n                                        user_key: data.user_key\n                                    });\n                                }\n                            });\n                        }\n                    }\n                });\n            });\n            socket.on(\"updateLastCheck\", async function(roomInfo, user_key) {\n                let date = (0,_utils_getTime__WEBPACK_IMPORTED_MODULE_2__.getTime)();\n                if (roomInfo.create_user_key === user_key) {\n                    await (0,_database_index__WEBPACK_IMPORTED_MODULE_0__.executeQuery)(\"UPDATE private_room SET last_create_user = ? WHERE room_id = ?\", [\n                        date,\n                        roomInfo.room_id\n                    ]).then(()=>{\n                        io.to(user_key).emit(\"updateNewMessage\", {\n                            data: roomInfo,\n                            user_key\n                        });\n                    });\n                } else {\n                    await (0,_database_index__WEBPACK_IMPORTED_MODULE_0__.executeQuery)(\"UPDATE private_room SET last_target_user = ? WHERE room_id = ?\", [\n                        date,\n                        roomInfo.room_id\n                    ]).then(()=>{\n                        io.to(user_key).emit(\"updateNewMessage\", {\n                            data: roomInfo,\n                            user_key\n                        });\n                    });\n                }\n            });\n            socket.on(\"updateMessageCheck\", async function(message, user_key) {\n                let date = (0,_utils_getTime__WEBPACK_IMPORTED_MODULE_2__.getTime)();\n                if (message.isCreateUser) {\n                    await (0,_database_index__WEBPACK_IMPORTED_MODULE_0__.executeQuery)(\"UPDATE private_room SET last_create_user = ? WHERE room_id = ?\", [\n                        date,\n                        message.room_id\n                    ]).then(()=>{\n                        io.to(user_key).emit(\"updateNewMessage\", {\n                            data: message,\n                            user_key\n                        });\n                    });\n                } else {\n                    await (0,_database_index__WEBPACK_IMPORTED_MODULE_0__.executeQuery)(\"UPDATE private_room SET last_target_user = ? WHERE room_id = ?\", [\n                        date,\n                        message.room_id\n                    ]).then(()=>{\n                        io.to(user_key).emit(\"updateNewMessage\", {\n                            data: message,\n                            user_key\n                        });\n                    });\n                }\n            });\n            socket.on(\"createPrivateRoom\", async function(data) {\n                await (0,_database_index__WEBPACK_IMPORTED_MODULE_0__.executeQuery)(\"SELECT * FROM private_room WHERE (create_user_key = ? AND target_user_key = ?) OR (create_user_key = ? AND target_user_key = ?)\", [\n                    data.user_key,\n                    data.target_user_key,\n                    data.target_user_key,\n                    data.user_key\n                ]).then(async (result)=>{\n                    if (!result[0]) {\n                        await (0,_database_index__WEBPACK_IMPORTED_MODULE_0__.executeQuery)(\"SELECT count(*) count FROM private_room WHERE create_nickname = ? OR target_nickname = ? \", [\n                            data.nickname,\n                            data.nickname\n                        ]).then(async (result)=>{\n                            if (result[0].count < 5) {\n                                const roomId = (0,_utils_randomUUID__WEBPACK_IMPORTED_MODULE_3__.randomUUID)(5);\n                                data.room_id = roomId;\n                                let date = (0,_utils_getTime__WEBPACK_IMPORTED_MODULE_2__.getTime)();\n                                await (0,_database_index__WEBPACK_IMPORTED_MODULE_0__.executeQuery)(\"INSERT INTO private_room (room_id, create_user_key, create_nickname, target_user_key, target_nickname, last_nickname, last_text, create_date, last_date, last_create_user) values (?,?,?,?,?,?,?,?,?,?)\", [\n                                    roomId,\n                                    data.user_key,\n                                    data.nickname,\n                                    data.target_user_key,\n                                    data.target_nickname,\n                                    data.nickname,\n                                    \"채팅방이 생성되었습니다.\",\n                                    date,\n                                    date,\n                                    date\n                                ]).then((result)=>{\n                                    if (result.insertId) {\n                                        console.log(\"[개인채팅 생성(로비)] : \", data);\n                                        io.to(data.user_key).emit(\"createPrivateRoomResult\", data);\n                                    } else {\n                                        console.log(\"[개인채팅 생성(로비) 실패]\", result);\n                                    }\n                                }, function(err) {\n                                    res.send(err);\n                                });\n                            } else {\n                                io.to(data.user_key).emit(\"createPrivateRoomResult\", {\n                                    status: false,\n                                    message: \"[⚠️]참여중인 1:1 대화방이 (5)개 이상입니다. 대화를 먼저 걸 수 없습니다.\"\n                                });\n                            }\n                        });\n                    } else {\n                        io.to(data.user_key).emit(\"openPrivateRoom\", result[0]);\n                    }\n                });\n            });\n            socket.on(\"fromRoomCreatePrivateRoom\", async function(data) {\n                await (0,_database_index__WEBPACK_IMPORTED_MODULE_0__.executeQuery)(\"SELECT * FROM private_room WHERE (create_user_key = ? AND target_user_key = ?) OR (create_user_key = ? AND target_user_key = ?)\", [\n                    data.user_key,\n                    data.target_user_key,\n                    data.target_user_key,\n                    data.user_key\n                ]).then(async (result)=>{\n                    if (!result[0]) {\n                        await (0,_database_index__WEBPACK_IMPORTED_MODULE_0__.executeQuery)(\"SELECT count(*) count FROM private_room WHERE create_nickname = ? OR target_nickname = ? \", [\n                            data.nickname,\n                            data.nickname\n                        ]).then(async (result)=>{\n                            if (result[0].count < 5) {\n                                const roomId = (0,_utils_randomUUID__WEBPACK_IMPORTED_MODULE_3__.randomUUID)(5);\n                                data.room_id = roomId;\n                                let date = (0,_utils_getTime__WEBPACK_IMPORTED_MODULE_2__.getTime)();\n                                await (0,_database_index__WEBPACK_IMPORTED_MODULE_0__.executeQuery)(\"INSERT INTO private_room (room_id, create_user_key, create_nickname, target_user_key, target_nickname, last_nickname, last_text, create_date, last_date, last_create_user) values (?,?,?,?,?,?,?,?,?,?)\", [\n                                    roomId,\n                                    data.user_key,\n                                    data.nickname,\n                                    data.target_user_key,\n                                    data.target_nickname,\n                                    data.nickname,\n                                    \"채팅방이 생성되었습니다.\",\n                                    date,\n                                    date,\n                                    date\n                                ]).then((result)=>{\n                                    if (result.insertId) {\n                                        console.log(\"[개인채팅 생성(룸)] : \", data);\n                                        io.to(data.user_key).emit(\"fromRoomCreatePrivateRoomResult\", data);\n                                    } else {\n                                        console.log(\"[개인채팅 생성 실패 (룸)] : \", result);\n                                    }\n                                }, function(err) {\n                                    res.send(err);\n                                });\n                            } else {\n                                io.to(data.user_key).emit(\"fromRoomCreatePrivateRoomResult\", {\n                                    status: false,\n                                    message: \"[⚠️]참여중인 1:1 대화방이 (5)개 이상입니다. 대화를 먼저 걸 수 없습니다.\"\n                                });\n                            }\n                        });\n                    } else {\n                        io.to(data.user_key).emit(\"fromRoomOpenPrivateRoom\", result[0]);\n                    }\n                });\n            });\n        // socket.on('getPrivateMessageList', async function(roomId, user_key){\n        //   await executeQuery(\"SELECT * FROM private_message WHERE room_id = ?\", [roomId]).then((list)=>{\n        //     io.to(user_key).emit('privateMessageList', list);\n        //   })\n        // })\n        // socket.on(\"disconnect\", function(){\n        //   for (var [key, value] of io.sockets.adapter.rooms) {\n        //     // console.log(io.sockets.adapter.rooms, key, value, \"disconnect\")\n        //     // console.log(key, value, \"disconnect\")\n        //     // socket.leave(key)\n        //   }\n        // })\n        // if(!io.sockets.adapter.rooms.has(user_key)){\n        //   socket.join(user_key)\n        // }else{\n        //   // for (var [key, value] of io.sockets.adapter.rooms) {\n        //   //   if(key === user_key){\n        //   //     socket.id = value.values().next().value\n        //   //   }else{\n        //   //     console.log(value.values().next().value)\n        //   //   }\n        //   // }\n        // }\n        });\n    }\n    res.send(200);\n};\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (SocketHandler);\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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RCx5RUFBeUU7UUFDekUsK0NBQStDO1FBRS9DLDJCQUEyQjtRQUMzQixNQUFNO1FBQ04sS0FBSztRQUVHLCtDQUErQztRQUNyRCwwQkFBMEI7UUFFMUIsU0FBUztRQUVULDREQUE0RDtRQUM1RCwrQkFBK0I7UUFDL0IsbURBQW1EO1FBQ25ELGdCQUFnQjtRQUVoQixvREFBb0Q7UUFFcEQsV0FBVztRQUNYLFNBQVM7UUFDVCxJQUFJO1FBRVI7SUFDRixDQUFDO0lBQ0Q3QixJQUFJa0QsSUFBSSxDQUFDO0FBRVg7QUFFQSxpRUFBZXBELGFBQWFBLEVBQUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9qb290b25nLy4vcGFnZXMvYXBpL21lc3NhZ2Uvd2Vic29ja2V0LmpzP2U4MDQiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZXhlY3V0ZVF1ZXJ5IH0gZnJvbSAnI2RhdGFiYXNlL2luZGV4JztcclxuaW1wb3J0IHsgU2VydmVyIH0gZnJvbSBcInNvY2tldC5pb1wiO1xyXG5pbXBvcnQgeyBnZXRUaW1lIH0gZnJvbSAnI3V0aWxzL2dldFRpbWUnO1xyXG5pbXBvcnQgeyByYW5kb21VVUlEIH0gZnJvbSBcIiN1dGlscy9yYW5kb21VVUlEXCI7XHJcbmNvbnN0IGZzID0gcmVxdWlyZSgnZnMnKTtcclxuaW1wb3J0IFVBUGFyc2VyIGZyb20gXCJ1YS1wYXJzZXItanNcIjtcclxubGV0IHRvZGF5SW1hZ2VGb2xkZXIgPSBmYWxzZTtcclxuXHJcbmNvbnN0IFNvY2tldEhhbmRsZXIgPSAocmVxLCByZXMpID0+IHtcclxuXHJcbiAgaWYocmVzLnNvY2tldC5zZXJ2ZXIuaW8pe1xyXG4gICAgY29uc3QgdXNlckluZm8gPSBVQVBhcnNlcihyZXEuaGVhZGVyc1tcInVzZXItYWdlbnRcIl0pO1xyXG4gICAgY29uc3QgaXAgPSByZXEuY2xpZW50SXA7XHJcbiAgICBjb25zb2xlLmxvZyhcIlNvY2tldCBpcyBhbHJlYWR5IHJ1bm5pbmdcIiwgaXAsIHVzZXJJbmZvLm9zLCB1c2VySW5mby5icm93c2VyLCB1c2VySW5mby5kZXZpY2UpO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBjb25zdCB1c2VySW5mbyA9IFVBUGFyc2VyKHJlcS5oZWFkZXJzW1widXNlci1hZ2VudFwiXSk7XHJcbiAgICBjb25zdCBpcCA9IHJlcS5jbGllbnRJcDtcclxuICAgIGNvbnNvbGUubG9nKFwiU29ja2V0IGlzIGNvbm5jZXQgOlwiLCBpcCwgdXNlckluZm8ub3MsIHVzZXJJbmZvLmJyb3dzZXIsIHVzZXJJbmZvLmRldmljZSk7XHJcbiAgICBjb25zdCBpbyA9IG5ldyBTZXJ2ZXIocmVzLnNvY2tldC5zZXJ2ZXIpXHJcbiAgICByZXMuc29ja2V0LnNlcnZlci5pbyA9IGlvXHJcbiAgICBcclxuICAgIGlvLm9mKHJlcS5xdWVyeS5uYW1lc3BhY2UpLm9uKCdjb25uZWN0aW9uJywgc29ja2V0ID0+IHtcclxuICAgICAgY29uc3QgY291bnQgPSBpby5vZihcIi9cIikuc29ja2V0cy5zaXplO1xyXG4gICAgICBjb25zb2xlLmxvZyhcImNvdW50IDpcIiwgY291bnQpXHJcbiAgICAgIGlvLm9mKHJlcS5xdWVyeS5uYW1lc3BhY2UpLmVtaXQoJ2NvdW50JywgY291bnQpO1xyXG5cclxuICAgICAgc29ja2V0Lm9uKCdwcml2YXRlQ29ubmVjdCcsIGZ1bmN0aW9uKHVzZXJfa2V5KXtcclxuICAgICAgICBzb2NrZXQuam9pbih1c2VyX2tleSk7XHJcblxyXG4gICAgICB9KVxyXG5cclxuICAgICAgc29ja2V0Lm9uKCdqb2luUm9vbScsIGFzeW5jIGZ1bmN0aW9uKHJvb21JZCl7XHJcbiAgICAgICAgc29ja2V0LmpvaW4ocm9vbUlkKTtcclxuXHJcbiAgICAgICAgYXdhaXQgZXhlY3V0ZVF1ZXJ5KFwiU0VMRUNUICogRlJPTSByb29tIFdIRVJFIHJvb21faWQgPSA/XCIsIFtyb29tSWRdKS50aGVuKChyZXN1bHRSb29tSW5mbykgPT4ge1xyXG4gICAgICAgICAgaW8udG8ocm9vbUlkKS5lbWl0KCdyb29tSW5mbycsIHJlc3VsdFJvb21JbmZvWzBdKTtcclxuICAgICAgICB9KVxyXG4gICAgICB9KVxyXG5cclxuICAgICAgc29ja2V0Lm9uKCdqb2luUHJpdmF0ZVJvb20nLCBmdW5jdGlvbihyb29tSWQpe1xyXG4gICAgICAgIHNvY2tldC5qb2luKHJvb21JZCk7XHJcbiAgICAgIH0pXHJcblxyXG4gICAgICBzb2NrZXQub24oJ3JlSm9pblByaXZhdGVSb29tJywgYXN5bmMgZnVuY3Rpb24oZGF0YSl7XHJcbiAgICAgICAgYXdhaXQgZXhlY3V0ZVF1ZXJ5KFwiU0VMRUNUIGNvdW50KCopIGNvdW50IEZST00gcHJpdmF0ZV9yb29tIFdIRVJFIGNyZWF0ZV9uaWNrbmFtZSA9ID8gT1IgdGFyZ2V0X25pY2tuYW1lID0gPyBcIixcclxuICAgICAgICBbZGF0YS5uaWNrbmFtZSwgZGF0YS5uaWNrbmFtZV0pLnRoZW4oIGFzeW5jIChyZXN1bHQpPT57XHJcbiAgICAgICAgICBpZihyZXN1bHRbMF0uY291bnQgPCA1KXtcclxuICAgICAgICAgICAgaWYoZGF0YS50YXJnZXQgPT09IFwidGFyZ2V0XCIpe1xyXG4gICAgICAgICAgICAgIGF3YWl0IGV4ZWN1dGVRdWVyeShcIlVQREFURSBwcml2YXRlX3Jvb20gU0VUIHRhcmdldF9uaWNrbmFtZSA9ID8gV0hFUkUgcm9vbV9pZCA9ID9cIiwgW2RhdGEubmlja25hbWUsIGRhdGEucm9vbV9pZF0pLnRoZW4oYXN5bmMgZnVuY3Rpb24ocmVzdWx0KXtcclxuICAgICAgICAgICAgICAgIGlmKHR5cGVvZiByZXN1bHQuYWZmZWN0ZWRSb3dzID09PSBcIm51bWJlclwiKXtcclxuICAgICAgICAgICAgICAgICAgYXdhaXQgZXhlY3V0ZVF1ZXJ5KFwiU0VMRUNUICogRlJPTSBwcml2YXRlX21lc3NhZ2UgV0hFUkUgcm9vbV9pZCA9ID9cIiwgW2RhdGEucm9vbV9pZF0pLnRoZW4oKGxpc3QpPT57XHJcbiAgICAgICAgICAgICAgICAgICAgc29ja2V0LmpvaW4oZGF0YS5yb29tX2lkKTtcclxuICAgICAgICAgICAgICAgICAgICBkYXRhLm1lc3NhZ2VMaXN0ID0gbGlzdFxyXG4gICAgICAgICAgICAgICAgICAgIGlvLnRvKGRhdGEucm9vbV9pZCkuZW1pdChcInJlSm9pblByaXZhdGVSb29tXCIsIGRhdGEpXHJcbiAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICBhd2FpdCBleGVjdXRlUXVlcnkoXCJVUERBVEUgcHJpdmF0ZV9yb29tIFNFVCBjcmVhdGVfbmlja25hbWUgPSA/IFdIRVJFIHJvb21faWQgPSA/XCIsIFtkYXRhLm5pY2tuYW1lLCBkYXRhLnJvb21faWRdKS50aGVuKGFzeW5jIGZ1bmN0aW9uKHJlc3VsdCl7XHJcbiAgICAgICAgICAgICAgICBpZih0eXBlb2YgcmVzdWx0LmFmZmVjdGVkUm93cyA9PT0gXCJudW1iZXJcIil7XHJcbiAgICAgICAgICAgICAgICAgIGF3YWl0IGV4ZWN1dGVRdWVyeShcIlNFTEVDVCAqIEZST00gcHJpdmF0ZV9tZXNzYWdlIFdIRVJFIHJvb21faWQgPSA/XCIsIFtkYXRhLnJvb21faWRdKS50aGVuKChsaXN0KT0+e1xyXG4gICAgICAgICAgICAgICAgICAgIHNvY2tldC5qb2luKGRhdGEucm9vbV9pZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5tZXNzYWdlTGlzdCA9IGxpc3RcclxuICAgICAgICAgICAgICAgICAgICBpby50byhkYXRhLnJvb21faWQpLmVtaXQoXCJyZUpvaW5Qcml2YXRlUm9vbVwiLCBkYXRhKVxyXG4gICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBpby50byhkYXRhLnVzZXJfa2V5KS5lbWl0KFwiY3JlYXRlUHJpdmF0ZVJvb21SZXN1bHRcIiwge1xyXG4gICAgICAgICAgICAgIHN0YXR1czpmYWxzZSxcclxuICAgICAgICAgICAgICBtZXNzYWdlIDogXCJb4pqg77iPMToxIOyxhO2MheuwqSDqsJzshKQg7Jik66WYXSAxOjEg7LGE7YyF67CpIOywuOyXrCDqsJzsiJgoNSkg66W8IOy0iOqzvO2VmOyYgOyKteuLiOuLpC5cIlxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KVxyXG4gICAgICB9KVxyXG5cclxuICAgICAgc29ja2V0Lm9uKCdkZWxldGVSb29tJywgYXN5bmMgZnVuY3Rpb24oZGF0YSl7XHJcbiAgICAgICAgYXdhaXQgZXhlY3V0ZVF1ZXJ5KFwiU0VMRUNUICogRlJPTSByb29tIFdIRVJFIHJvb21faWQgPSA/XCIsIFtkYXRhLnJvb21JZF0pLnRoZW4oIGFzeW5jKHJlc3VsdCkgPT4ge1xyXG4gICAgICAgICAgaWYocmVzdWx0WzBdLmNyZWF0ZV91c2VyX2tleSA9PT0gZGF0YS51c2VyX2tleSApe1xyXG4gICAgICAgICAgICBhd2FpdCBleGVjdXRlUXVlcnkoXCJERUxFVEUgRlJPTSByb29tLCBtZXNzYWdlIFVTSU5HIHJvb20gSU5ORVIgSk9JTiBtZXNzYWdlIE9OIHJvb20ucm9vbV9pZCA9IG1lc3NhZ2Uucm9vbV9pZCBXSEVSRSByb29tLnJvb21faWQgPSA/XCIsIFtyZXN1bHRbMF0ucm9vbV9pZF0pLnRoZW4oIGFzeW5jIChkZWxldGVSZXN1bHQpPT57XHJcbiAgICAgICAgICAgICAgaWYoZGVsZXRlUmVzdWx0LmFmZmVjdGVkUm93cyl7XHJcbiAgICAgICAgICAgICAgICBpby50byhkYXRhLnJvb21JZCkuZW1pdCgnZGVsZXRlUm9vbScsIHJlc3VsdCk7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIFxyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgaW8udG8oZGF0YS5uaWNrbmFtZSkuZW1pdCgnZGVsZXRlUm9vbScsIHtcclxuICAgICAgICAgICAgICB1c2VyX2tleSA6IGRhdGEudXNlcl9rZXksXHJcbiAgICAgICAgICAgICAgbWVzc2FnZTpcIuyCreygnCDqtoztlZzsnbQg7JeG7Iq164uI64ukLlwiXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcbiAgICAgIH0pXHJcblxyXG4gICAgICBzb2NrZXQub24oJ2RlbGV0ZVByaXZhdGVSb29tJywgYXN5bmMgZnVuY3Rpb24oZGF0YSl7XHJcbiAgICAgICAgYXdhaXQgZXhlY3V0ZVF1ZXJ5KFwiVVBEQVRFIHByaXZhdGVfcm9vbSBTRVQgY3JlYXRlX25pY2tuYW1lID0gUkVQTEFDRShjcmVhdGVfbmlja25hbWUsID8sICcnKSwgdGFyZ2V0X25pY2tuYW1lID0gUkVQTEFDRSh0YXJnZXRfbmlja25hbWUsID8sICcnKSBXSEVSRSByb29tX2lkID0gP1wiLCBbZGF0YS5uaWNrbmFtZSwgZGF0YS5uaWNrbmFtZSwgZGF0YS5yb29tX2lkXSkudGhlbihhc3luYyBmdW5jdGlvbihyZXN1bHQpe1xyXG4gICAgICAgICAgaWYodHlwZW9mIHJlc3VsdC5hZmZlY3RlZFJvd3MgPT09IFwibnVtYmVyXCIpe1xyXG4gICAgICAgICAgICBpby50byhkYXRhLnJvb21faWQpLmVtaXQoJ2RlbGV0ZVByaXZhdGVSb29tJywgZGF0YSk7XHJcbiAgICAgICAgICAgIGlvLnRvKGRhdGEudXNlcl9rZXkpLmVtaXQoJ2RlbGV0ZVByaXZhdGVSb29tJywgZGF0YSk7XHJcblxyXG4gICAgICAgICAgICBhd2FpdCBleGVjdXRlUXVlcnkoXCJTRUxFQ1Qgcm9vbV9pZCwgY3JlYXRlX25pY2tuYW1lLCB0YXJnZXRfbmlja25hbWUgRlJPTSBwcml2YXRlX3Jvb20gV0hFUkUgcm9vbV9pZCA9ID9cIiwgW2RhdGEucm9vbV9pZF0pLnRoZW4oIGFzeW5jIGZ1bmN0aW9uKHJlc3VsdCl7XHJcbiAgICAgICAgICAgICAgaWYocmVzdWx0WzBdLmNyZWF0ZV9uaWNrbmFtZSA9PT0gXCJcIiAmJiByZXN1bHRbMF0udGFyZ2V0X25pY2tuYW1lID09PSBcIlwiKXtcclxuICAgICAgICAgICAgICAgIGF3YWl0IGV4ZWN1dGVRdWVyeShcIkRFTEVURSBGUk9NIHByaXZhdGVfcm9vbSwgcHJpdmF0ZV9tZXNzYWdlIFVTSU5HIHByaXZhdGVfcm9vbSBJTk5FUiBKT0lOIHByaXZhdGVfbWVzc2FnZSBPTiBwcml2YXRlX3Jvb20ucm9vbV9pZCA9IHByaXZhdGVfbWVzc2FnZS5yb29tX2lkIFdIRVJFIHByaXZhdGVfcm9vbS5yb29tX2lkID0gP1wiLCBbcmVzdWx0WzBdLnJvb21faWRdKS50aGVuKCgpPT57XHJcbiAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiW3ByaXZhdGUgZGF0YSBkZWxldGUgY29tcGxldGUgd2hlbiByb29tX2lkXSA9XCIsIHJlc3VsdFswXS5yb29tX2lkKVxyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSlcclxuICAgICAgfSlcclxuXHJcbiAgICAgIHNvY2tldC5vbignbG9iYnlNZXNzYWdlJywgYXN5bmMgZnVuY3Rpb24oZGF0YSl7XHJcbiAgICAgICAgZGF0YS5zZW5kX2RhdGUgPSBnZXRUaW1lKCk7XHJcblxyXG4gICAgICAgIGlvLm9mKHJlcS5xdWVyeS5uYW1lc3BhY2UpLmVtaXQoJ2dldExvYmJ5TWVzc2FnZScsIGRhdGEpO1xyXG4gICAgICB9KVxyXG5cclxuICAgICAgc29ja2V0Lm9uKFwicm9vbU1lc3NhZ2VTZW5kXCIsIGFzeW5jIGZ1bmN0aW9uKGRhdGEpe1xyXG4gICAgICAgIGlmKCFkYXRhLmltYWdlICYmICFkYXRhLnRleHQpIHJldHVybiBmYWxzZTtcclxuICAgICAgICBkYXRhLnNlbmRfZGF0ZSA9IGdldFRpbWUoKTtcclxuXHJcbiAgICAgICAgYXdhaXQgZXhlY3V0ZVF1ZXJ5KCdJTlNFUlQgSU5UTyBtZXNzYWdlKHJvb21faWQsIG5pY2tuYW1lLCB1c2VyX2tleSwgdGV4dCwgaW1hZ2UsIHNlbmRfZGF0ZSkgdmFsdWVzICg/LCA/LCA/LCA/LCA/LCA/KScsIFxyXG4gICAgICAgIFtkYXRhLnJvb21faWQsIGRhdGEubmlja25hbWUsIGRhdGEudXNlcl9rZXksIGRhdGEudGV4dCwgZGF0YS5pbWFnZSwgZGF0YS5zZW5kX2RhdGVdKS50aGVuKGFzeW5jIGZ1bmN0aW9uKHJlc3VsdCl7XHJcbiAgICAgICAgICBpZihyZXN1bHQuYWZmZWN0ZWRSb3dzKXtcclxuICAgICAgICAgICAgaW8udG8oZGF0YS5yb29tX2lkKS5lbWl0KCdyb29tTWVzc2FnZScsIGRhdGEpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcbiAgICAgIH0pXHJcblxyXG4gICAgICBzb2NrZXQub24oXCJwcml2YXRlTWVzc2FnZVNlbmRcIiwgYXN5bmMgZnVuY3Rpb24oZGF0YSl7XHJcbiAgICAgICAgaWYoIWRhdGEuaW1hZ2UgJiYgIWRhdGEudGV4dCkgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIGRhdGEuc2VuZF9kYXRlID0gZ2V0VGltZSgpO1xyXG4gICAgICAgIGF3YWl0IGV4ZWN1dGVRdWVyeSgnSU5TRVJUIElOVE8gcHJpdmF0ZV9tZXNzYWdlKHJvb21faWQsIG5pY2tuYW1lLCB1c2VyX2tleSwgdGV4dCwgaW1hZ2UsIHNlbmRfZGF0ZSkgdmFsdWVzICg/LCA/LCA/LCA/LCA/LCA/KScsIFxyXG4gICAgICAgIFtkYXRhLnJvb21faWQsIGRhdGEubmlja25hbWUsIGRhdGEudXNlcl9rZXksIGRhdGEudGV4dCwgZGF0YS5pbWFnZSwgZGF0YS5zZW5kX2RhdGVdXHJcbiAgICAgICAgKS50aGVuKGFzeW5jIGZ1bmN0aW9uKHJlc3VsdCl7XHJcbiAgICAgICAgICBpZihyZXN1bHQuYWZmZWN0ZWRSb3dzKXtcclxuICAgICAgICAgICAgaWYoZGF0YS5pc0NyZWF0ZVVzZXIpe1xyXG4gICAgICAgICAgICAgIGF3YWl0IGV4ZWN1dGVRdWVyeSgnVVBEQVRFIHByaXZhdGVfcm9vbSBTRVQgbGFzdF9kYXRlPT8sIGxhc3Rfbmlja25hbWU9PywgbGFzdF90ZXh0PT8sIGxhc3RfY3JlYXRlX3VzZXIgPT8gV0hFUkUgcm9vbV9pZD0/JywgXHJcbiAgICAgICAgICAgICAgW2RhdGEuc2VuZF9kYXRlLCBkYXRhLm5pY2tuYW1lLCBkYXRhLnRleHQsIGRhdGEuc2VuZF9kYXRlLCBkYXRhLnJvb21faWRdKS50aGVuKGZ1bmN0aW9uKHJlc3VsdCl7XHJcbiAgICAgICAgICAgICAgICBpZihyZXN1bHQuYWZmZWN0ZWRSb3dzKXtcclxuXHJcbiAgICAgICAgICAgICAgICAgIGlvLnRvKGRhdGEucm9vbV9pZCkuZW1pdCgncHJpdmF0ZU1lc3NhZ2UnLCBkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgaW8udG8oZGF0YS50YXJnZXRfdXNlcl9rZXkpLmVtaXQoXCJ1cGRhdGVOZXdNZXNzYWdlXCIsIHtcclxuICAgICAgICAgICAgICAgICAgICBkYXRhLFxyXG4gICAgICAgICAgICAgICAgICAgIHVzZXJfa2V5IDogZGF0YS51c2VyX2tleVxyXG4gICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgaW8udG8oZGF0YS51c2VyX2tleSkuZW1pdChcInVwZGF0ZU5ld01lc3NhZ2VcIiwge1xyXG4gICAgICAgICAgICAgICAgICAgIGRhdGEsXHJcbiAgICAgICAgICAgICAgICAgICAgdXNlcl9rZXkgOiBkYXRhLnVzZXJfa2V5XHJcbiAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgIGF3YWl0IGV4ZWN1dGVRdWVyeSgnVVBEQVRFIHByaXZhdGVfcm9vbSBTRVQgbGFzdF9kYXRlPT8sIGxhc3Rfbmlja25hbWU9PywgbGFzdF90ZXh0PT8sIGxhc3RfdGFyZ2V0X3VzZXIgPT8gV0hFUkUgcm9vbV9pZD0/JywgXHJcbiAgICAgICAgICAgICAgW2RhdGEuc2VuZF9kYXRlLCBkYXRhLm5pY2tuYW1lLCBkYXRhLnRleHQsIGRhdGEuc2VuZF9kYXRlLCBkYXRhLnJvb21faWRdKS50aGVuKGZ1bmN0aW9uKHJlc3VsdCl7XHJcbiAgICAgICAgICAgICAgICBpZihyZXN1bHQuYWZmZWN0ZWRSb3dzKXtcclxuICAgICAgICAgICAgICAgICAgaW8udG8oZGF0YS5yb29tX2lkKS5lbWl0KCdwcml2YXRlTWVzc2FnZScsIGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICBpby50byhkYXRhLnRhcmdldF91c2VyX2tleSkuZW1pdChcInVwZGF0ZU5ld01lc3NhZ2VcIiwge1xyXG4gICAgICAgICAgICAgICAgICAgIGRhdGEsXHJcbiAgICAgICAgICAgICAgICAgICAgdXNlcl9rZXkgOiBkYXRhLnVzZXJfa2V5XHJcbiAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICBpby50byhkYXRhLnVzZXJfa2V5KS5lbWl0KFwidXBkYXRlTmV3TWVzc2FnZVwiLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YSxcclxuICAgICAgICAgICAgICAgICAgICB1c2VyX2tleSA6IGRhdGEudXNlcl9rZXlcclxuICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICB9KVxyXG4gICAgICB9KVxyXG4gICAgICAgICAgICBcclxuICAgICAgc29ja2V0Lm9uKFwidXBkYXRlTGFzdENoZWNrXCIsIGFzeW5jIGZ1bmN0aW9uKHJvb21JbmZvLCB1c2VyX2tleSl7XHJcbiAgICAgICAgbGV0IGRhdGUgPSBnZXRUaW1lKCk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgaWYocm9vbUluZm8uY3JlYXRlX3VzZXJfa2V5ID09PSB1c2VyX2tleSl7XHJcbiAgICAgICAgICBhd2FpdCBleGVjdXRlUXVlcnkoXCJVUERBVEUgcHJpdmF0ZV9yb29tIFNFVCBsYXN0X2NyZWF0ZV91c2VyID0gPyBXSEVSRSByb29tX2lkID0gP1wiLCBbZGF0ZSwgcm9vbUluZm8ucm9vbV9pZF0pLnRoZW4oKCk9PntcclxuICAgICAgICAgICAgaW8udG8odXNlcl9rZXkpLmVtaXQoXCJ1cGRhdGVOZXdNZXNzYWdlXCIsIHtcclxuICAgICAgICAgICAgICBkYXRhIDogcm9vbUluZm8sXHJcbiAgICAgICAgICAgICAgdXNlcl9rZXlcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgIH0pXHJcblxyXG4gICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgYXdhaXQgZXhlY3V0ZVF1ZXJ5KFwiVVBEQVRFIHByaXZhdGVfcm9vbSBTRVQgbGFzdF90YXJnZXRfdXNlciA9ID8gV0hFUkUgcm9vbV9pZCA9ID9cIiwgW2RhdGUsIHJvb21JbmZvLnJvb21faWRdKS50aGVuKCgpPT57XHJcbiAgICAgICAgICAgIGlvLnRvKHVzZXJfa2V5KS5lbWl0KFwidXBkYXRlTmV3TWVzc2FnZVwiLCB7XHJcbiAgICAgICAgICAgICAgZGF0YSA6IHJvb21JbmZvLFxyXG4gICAgICAgICAgICAgIHVzZXJfa2V5XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgIH1cclxuICAgICAgfSlcclxuICAgICAgXHJcbiAgICAgIHNvY2tldC5vbihcInVwZGF0ZU1lc3NhZ2VDaGVja1wiLCBhc3luYyBmdW5jdGlvbihtZXNzYWdlLCB1c2VyX2tleSl7XHJcbiAgICAgICAgbGV0IGRhdGUgPSBnZXRUaW1lKCk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgaWYobWVzc2FnZS5pc0NyZWF0ZVVzZXIpe1xyXG4gICAgICAgICAgYXdhaXQgZXhlY3V0ZVF1ZXJ5KFwiVVBEQVRFIHByaXZhdGVfcm9vbSBTRVQgbGFzdF9jcmVhdGVfdXNlciA9ID8gV0hFUkUgcm9vbV9pZCA9ID9cIiwgW2RhdGUsIG1lc3NhZ2Uucm9vbV9pZF0pLnRoZW4oKCk9PntcclxuICAgICAgICAgICAgaW8udG8odXNlcl9rZXkpLmVtaXQoXCJ1cGRhdGVOZXdNZXNzYWdlXCIsIHtcclxuICAgICAgICAgICAgICBkYXRhIDogbWVzc2FnZSxcclxuICAgICAgICAgICAgICB1c2VyX2tleVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgfSlcclxuXHJcbiAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICBhd2FpdCBleGVjdXRlUXVlcnkoXCJVUERBVEUgcHJpdmF0ZV9yb29tIFNFVCBsYXN0X3RhcmdldF91c2VyID0gPyBXSEVSRSByb29tX2lkID0gP1wiLCBbZGF0ZSwgbWVzc2FnZS5yb29tX2lkXSkudGhlbigoKT0+e1xyXG4gICAgICAgICAgICBpby50byh1c2VyX2tleSkuZW1pdChcInVwZGF0ZU5ld01lc3NhZ2VcIiwge1xyXG4gICAgICAgICAgICAgIGRhdGEgOiBtZXNzYWdlLFxyXG4gICAgICAgICAgICAgIHVzZXJfa2V5XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgIH1cclxuICAgICAgfSlcclxuXHJcbiAgICAgIHNvY2tldC5vbignY3JlYXRlUHJpdmF0ZVJvb20nLCBhc3luYyBmdW5jdGlvbihkYXRhKXtcclxuICAgICAgICBhd2FpdCBleGVjdXRlUXVlcnkoXCJTRUxFQ1QgKiBGUk9NIHByaXZhdGVfcm9vbSBXSEVSRSAoY3JlYXRlX3VzZXJfa2V5ID0gPyBBTkQgdGFyZ2V0X3VzZXJfa2V5ID0gPykgT1IgKGNyZWF0ZV91c2VyX2tleSA9ID8gQU5EIHRhcmdldF91c2VyX2tleSA9ID8pXCIsXHJcbiAgICAgICAgW2RhdGEudXNlcl9rZXksIGRhdGEudGFyZ2V0X3VzZXJfa2V5LCBkYXRhLnRhcmdldF91c2VyX2tleSwgZGF0YS51c2VyX2tleV0pLnRoZW4oIGFzeW5jIChyZXN1bHQpPT57XHJcbiAgICAgICAgICBcclxuICAgICAgICAgIGlmKCFyZXN1bHRbMF0pe1xyXG4gICAgICAgICAgICBhd2FpdCBleGVjdXRlUXVlcnkoXCJTRUxFQ1QgY291bnQoKikgY291bnQgRlJPTSBwcml2YXRlX3Jvb20gV0hFUkUgY3JlYXRlX25pY2tuYW1lID0gPyBPUiB0YXJnZXRfbmlja25hbWUgPSA/IFwiLFxyXG4gICAgICAgICAgICBbZGF0YS5uaWNrbmFtZSwgZGF0YS5uaWNrbmFtZV0pLnRoZW4oIGFzeW5jIChyZXN1bHQpPT57XHJcbiAgICAgICAgICAgICAgaWYocmVzdWx0WzBdLmNvdW50IDwgNSl7XHJcbiAgICAgICAgICAgICAgICBjb25zdCByb29tSWQgPSByYW5kb21VVUlEKDUpO1xyXG4gICAgICAgICAgICAgICAgZGF0YS5yb29tX2lkID0gcm9vbUlkO1xyXG4gICAgICAgICAgICAgICAgbGV0IGRhdGUgPSBnZXRUaW1lKCk7XHJcbiAgICAgICAgICAgICAgICBhd2FpdCBleGVjdXRlUXVlcnkoXHJcbiAgICAgICAgICAgICAgICAgIFwiSU5TRVJUIElOVE8gcHJpdmF0ZV9yb29tIChyb29tX2lkLCBjcmVhdGVfdXNlcl9rZXksIGNyZWF0ZV9uaWNrbmFtZSwgdGFyZ2V0X3VzZXJfa2V5LCB0YXJnZXRfbmlja25hbWUsIGxhc3Rfbmlja25hbWUsIGxhc3RfdGV4dCwgY3JlYXRlX2RhdGUsIGxhc3RfZGF0ZSwgbGFzdF9jcmVhdGVfdXNlcikgdmFsdWVzICg/LD8sPyw/LD8sPyw/LD8sPyw/KVwiLFxyXG4gICAgICAgICAgICAgICAgICBbcm9vbUlkLCBkYXRhLnVzZXJfa2V5LCBkYXRhLm5pY2tuYW1lLCBkYXRhLnRhcmdldF91c2VyX2tleSwgZGF0YS50YXJnZXRfbmlja25hbWUsIGRhdGEubmlja25hbWUsIFwi7LGE7YyF67Cp7J20IOyDneyEseuQmOyXiOyKteuLiOuLpC5cIiwgZGF0ZSwgZGF0ZSwgZGF0ZV0pLnRoZW4oKHJlc3VsdCk9PntcclxuICAgICAgICAgICAgICAgICAgaWYocmVzdWx0Lmluc2VydElkKXtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIlvqsJzsnbjssYTtjIUg7IOd7ISxKOuhnOu5hCldIDogXCIsIGRhdGEpXHJcbiAgICAgICAgICAgICAgICAgICAgaW8udG8oZGF0YS51c2VyX2tleSkuZW1pdChcImNyZWF0ZVByaXZhdGVSb29tUmVzdWx0XCIsIGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiW+qwnOyduOyxhO2MhSDsg53shLEo66Gc67mEKSDsi6TtjKhdXCIsIHJlc3VsdClcclxuICAgICAgICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihlcnIpe1xyXG4gICAgICAgICAgICAgICAgICByZXMuc2VuZChlcnIpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGlvLnRvKGRhdGEudXNlcl9rZXkpLmVtaXQoXCJjcmVhdGVQcml2YXRlUm9vbVJlc3VsdFwiLCB7XHJcbiAgICAgICAgICAgICAgICAgIHN0YXR1czpmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgbWVzc2FnZSA6IFwiW+KaoO+4j13ssLjsl6zspJHsnbggMToxIOuMgO2ZlOuwqeydtCAoNSnqsJwg7J207IOB7J6F64uI64ukLiDrjIDtmZTrpbwg66i87KCAIOqxuCDsiJgg7JeG7Iq164uI64ukLlwiXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBpby50byhkYXRhLnVzZXJfa2V5KS5lbWl0KFwib3BlblByaXZhdGVSb29tXCIsIHJlc3VsdFswXSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSlcclxuICAgICAgfSlcclxuXHJcbiAgICAgIHNvY2tldC5vbignZnJvbVJvb21DcmVhdGVQcml2YXRlUm9vbScsIGFzeW5jIGZ1bmN0aW9uKGRhdGEpe1xyXG4gICAgICAgIGF3YWl0IGV4ZWN1dGVRdWVyeShcIlNFTEVDVCAqIEZST00gcHJpdmF0ZV9yb29tIFdIRVJFIChjcmVhdGVfdXNlcl9rZXkgPSA/IEFORCB0YXJnZXRfdXNlcl9rZXkgPSA/KSBPUiAoY3JlYXRlX3VzZXJfa2V5ID0gPyBBTkQgdGFyZ2V0X3VzZXJfa2V5ID0gPylcIixcclxuICAgICAgICBbZGF0YS51c2VyX2tleSwgZGF0YS50YXJnZXRfdXNlcl9rZXksIGRhdGEudGFyZ2V0X3VzZXJfa2V5LCBkYXRhLnVzZXJfa2V5XSkudGhlbiggYXN5bmMgKHJlc3VsdCk9PntcclxuICAgICAgICAgIFxyXG4gICAgICAgICAgaWYoIXJlc3VsdFswXSl7XHJcbiAgICAgICAgICAgIGF3YWl0IGV4ZWN1dGVRdWVyeShcIlNFTEVDVCBjb3VudCgqKSBjb3VudCBGUk9NIHByaXZhdGVfcm9vbSBXSEVSRSBjcmVhdGVfbmlja25hbWUgPSA/IE9SIHRhcmdldF9uaWNrbmFtZSA9ID8gXCIsXHJcbiAgICAgICAgICAgIFtkYXRhLm5pY2tuYW1lLCBkYXRhLm5pY2tuYW1lXSkudGhlbiggYXN5bmMgKHJlc3VsdCk9PntcclxuICAgICAgICAgICAgICBpZihyZXN1bHRbMF0uY291bnQgPCA1KXtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHJvb21JZCA9IHJhbmRvbVVVSUQoNSk7XHJcbiAgICAgICAgICAgICAgICBkYXRhLnJvb21faWQgPSByb29tSWQ7XHJcbiAgICAgICAgICAgICAgICBsZXQgZGF0ZSA9IGdldFRpbWUoKTtcclxuICAgICAgICAgICAgICAgIGF3YWl0IGV4ZWN1dGVRdWVyeShcclxuICAgICAgICAgICAgICAgICAgXCJJTlNFUlQgSU5UTyBwcml2YXRlX3Jvb20gKHJvb21faWQsIGNyZWF0ZV91c2VyX2tleSwgY3JlYXRlX25pY2tuYW1lLCB0YXJnZXRfdXNlcl9rZXksIHRhcmdldF9uaWNrbmFtZSwgbGFzdF9uaWNrbmFtZSwgbGFzdF90ZXh0LCBjcmVhdGVfZGF0ZSwgbGFzdF9kYXRlLCBsYXN0X2NyZWF0ZV91c2VyKSB2YWx1ZXMgKD8sPyw/LD8sPyw/LD8sPyw/LD8pXCIsXHJcbiAgICAgICAgICAgICAgICAgIFtyb29tSWQsIGRhdGEudXNlcl9rZXksIGRhdGEubmlja25hbWUsIGRhdGEudGFyZ2V0X3VzZXJfa2V5LCBkYXRhLnRhcmdldF9uaWNrbmFtZSwgZGF0YS5uaWNrbmFtZSwgXCLssYTtjIXrsKnsnbQg7IOd7ISx65CY7JeI7Iq164uI64ukLlwiLCBkYXRlLCBkYXRlLCBkYXRlXSkudGhlbigocmVzdWx0KT0+e1xyXG4gICAgICAgICAgICAgICAgICBpZihyZXN1bHQuaW5zZXJ0SWQpe1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiW+qwnOyduOyxhO2MhSDsg53shLEo66O4KV0gOiBcIiwgZGF0YSlcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaW8udG8oZGF0YS51c2VyX2tleSkuZW1pdChcImZyb21Sb29tQ3JlYXRlUHJpdmF0ZVJvb21SZXN1bHRcIiwgZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJb6rCc7J247LGE7YyFIOyDneyEsSDsi6TtjKggKOujuCldIDogXCIsIHJlc3VsdClcclxuICAgICAgICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihlcnIpe1xyXG4gICAgICAgICAgICAgICAgICByZXMuc2VuZChlcnIpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGlvLnRvKGRhdGEudXNlcl9rZXkpLmVtaXQoXCJmcm9tUm9vbUNyZWF0ZVByaXZhdGVSb29tUmVzdWx0XCIsIHtcclxuICAgICAgICAgICAgICAgICAgc3RhdHVzOmZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICBtZXNzYWdlIDogXCJb4pqg77iPXeywuOyXrOykkeyduCAxOjEg64yA7ZmU67Cp7J20ICg1KeqwnCDsnbTsg4HsnoXri4jri6QuIOuMgO2ZlOulvCDrqLzsoIAg6rG4IOyImCDsl4bsirXri4jri6QuXCJcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGlvLnRvKGRhdGEudXNlcl9rZXkpLmVtaXQoXCJmcm9tUm9vbU9wZW5Qcml2YXRlUm9vbVwiLCByZXN1bHRbMF0pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcbiAgICAgIH0pXHJcblxyXG4gICAgICAvLyBzb2NrZXQub24oJ2dldFByaXZhdGVNZXNzYWdlTGlzdCcsIGFzeW5jIGZ1bmN0aW9uKHJvb21JZCwgdXNlcl9rZXkpe1xyXG4gICAgICAvLyAgIGF3YWl0IGV4ZWN1dGVRdWVyeShcIlNFTEVDVCAqIEZST00gcHJpdmF0ZV9tZXNzYWdlIFdIRVJFIHJvb21faWQgPSA/XCIsIFtyb29tSWRdKS50aGVuKChsaXN0KT0+e1xyXG4gICAgICAvLyAgICAgaW8udG8odXNlcl9rZXkpLmVtaXQoJ3ByaXZhdGVNZXNzYWdlTGlzdCcsIGxpc3QpO1xyXG4gICAgICAvLyAgIH0pXHJcbiAgICAgIC8vIH0pXHJcblxyXG4gICAgICAvLyBzb2NrZXQub24oXCJkaXNjb25uZWN0XCIsIGZ1bmN0aW9uKCl7XHJcbiAgICAgIC8vICAgZm9yICh2YXIgW2tleSwgdmFsdWVdIG9mIGlvLnNvY2tldHMuYWRhcHRlci5yb29tcykge1xyXG4gICAgICAvLyAgICAgLy8gY29uc29sZS5sb2coaW8uc29ja2V0cy5hZGFwdGVyLnJvb21zLCBrZXksIHZhbHVlLCBcImRpc2Nvbm5lY3RcIilcclxuICAgICAgLy8gICAgIC8vIGNvbnNvbGUubG9nKGtleSwgdmFsdWUsIFwiZGlzY29ubmVjdFwiKVxyXG5cclxuICAgICAgLy8gICAgIC8vIHNvY2tldC5sZWF2ZShrZXkpXHJcbiAgICAgIC8vICAgfVxyXG4gICAgICAvLyB9KVxyXG5cclxuICAgICAgICAgICAgICAvLyBpZighaW8uc29ja2V0cy5hZGFwdGVyLnJvb21zLmhhcyh1c2VyX2tleSkpe1xyXG4gICAgICAgIC8vICAgc29ja2V0LmpvaW4odXNlcl9rZXkpXHJcbiAgICAgICAgICBcclxuICAgICAgICAvLyB9ZWxzZXtcclxuXHJcbiAgICAgICAgLy8gICAvLyBmb3IgKHZhciBba2V5LCB2YWx1ZV0gb2YgaW8uc29ja2V0cy5hZGFwdGVyLnJvb21zKSB7XHJcbiAgICAgICAgLy8gICAvLyAgIGlmKGtleSA9PT0gdXNlcl9rZXkpe1xyXG4gICAgICAgIC8vICAgLy8gICAgIHNvY2tldC5pZCA9IHZhbHVlLnZhbHVlcygpLm5leHQoKS52YWx1ZVxyXG4gICAgICAgIC8vICAgLy8gICB9ZWxzZXtcclxuICBcclxuICAgICAgICAvLyAgIC8vICAgICBjb25zb2xlLmxvZyh2YWx1ZS52YWx1ZXMoKS5uZXh0KCkudmFsdWUpXHJcblxyXG4gICAgICAgIC8vICAgLy8gICB9XHJcbiAgICAgICAgLy8gICAvLyB9XHJcbiAgICAgICAgLy8gfVxyXG4gXHJcbiAgICB9KTtcclxuICB9XHJcbiAgcmVzLnNlbmQoMjAwKVxyXG5cclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgU29ja2V0SGFuZGxlcjtcclxuIl0sIm5hbWVzIjpbImV4ZWN1dGVRdWVyeSIsIlNlcnZlciIsImdldFRpbWUiLCJyYW5kb21VVUlEIiwiZnMiLCJyZXF1aXJlIiwiVUFQYXJzZXIiLCJ0b2RheUltYWdlRm9sZGVyIiwiU29ja2V0SGFuZGxlciIsInJlcSIsInJlcyIsInNvY2tldCIsInNlcnZlciIsImlvIiwidXNlckluZm8iLCJoZWFkZXJzIiwiaXAiLCJjbGllbnRJcCIsImNvbnNvbGUiLCJsb2ciLCJvcyIsImJyb3dzZXIiLCJkZXZpY2UiLCJvZiIsInF1ZXJ5IiwibmFtZXNwYWNlIiwib24iLCJjb3VudCIsInNvY2tldHMiLCJzaXplIiwiZW1pdCIsInVzZXJfa2V5Iiwiam9pbiIsInJvb21JZCIsInRoZW4iLCJyZXN1bHRSb29tSW5mbyIsInRvIiwiZGF0YSIsIm5pY2tuYW1lIiwicmVzdWx0IiwidGFyZ2V0Iiwicm9vbV9pZCIsImFmZmVjdGVkUm93cyIsImxpc3QiLCJtZXNzYWdlTGlzdCIsInN0YXR1cyIsIm1lc3NhZ2UiLCJjcmVhdGVfdXNlcl9rZXkiLCJkZWxldGVSZXN1bHQiLCJjcmVhdGVfbmlja25hbWUiLCJ0YXJnZXRfbmlja25hbWUiLCJzZW5kX2RhdGUiLCJpbWFnZSIsInRleHQiLCJpc0NyZWF0ZVVzZXIiLCJ0YXJnZXRfdXNlcl9rZXkiLCJyb29tSW5mbyIsImRhdGUiLCJpbnNlcnRJZCIsImVyciIsInNlbmQiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./pages/api/message/websocket.js\n");

/***/ }),

/***/ "(api)/./utils/getTime.js":
/*!**************************!*\
  !*** ./utils/getTime.js ***!
  \**************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"getTime\": () => (/* binding */ getTime)\n/* harmony export */ });\nconst getTime = (data = {})=>{\n    let date = data.date;\n    if (!date) {\n        date = new Date();\n    } else {\n        date = new Date(data.date);\n    }\n    let year = date.getFullYear();\n    let month = date.getMonth() + 1;\n    month < 10 ? month = \"0\" + month : null;\n    let day = date.getDate();\n    day < 10 ? day = \"0\" + day : null;\n    let hour = date.getHours();\n    hour < 10 ? hour = \"0\" + hour : null;\n    let minute = date.getMinutes();\n    minute < 10 ? minute = \"0\" + minute : null;\n    let second = date.getSeconds();\n    second < 10 ? second = \"0\" + second : null;\n    switch(data.format){\n        case \"YYYY/MM/DD\":\n            return year + \"/\" + month + \"/\" + day;\n        case \"HH:mm\":\n            return hour + \":\" + minute;\n        case \"HH\":\n            return hour;\n        case \"YYYY, MM, DD\":\n            return year + \",\" + month + \",\" + day;\n        case \"YYYYMMDD\":\n            return year + month + day;\n        case \"YYYY-MM-DD\":\n            return year - month - day;\n        default:\n            return year + \"/\" + month + \"/\" + day + \" \" + hour + \":\" + minute + \":\" + second;\n    }\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi91dGlscy9nZXRUaW1lLmpzLmpzIiwibWFwcGluZ3MiOiI7Ozs7QUFBTyxNQUFNQSxVQUFVLENBQUNDLE9BQU8sQ0FBQyxDQUFDLEdBQUs7SUFFcEMsSUFBSUMsT0FBT0QsS0FBS0MsSUFBSTtJQUNwQixJQUFHLENBQUNBLE1BQUs7UUFDUEEsT0FBTyxJQUFJQztJQUNiLE9BQUs7UUFDSEQsT0FBTyxJQUFJQyxLQUFLRixLQUFLQyxJQUFJO0lBQzNCLENBQUM7SUFFRCxJQUFJRSxPQUFPRixLQUFLRyxXQUFXO0lBQzNCLElBQUlDLFFBQVFKLEtBQUtLLFFBQVEsS0FBSztJQUM5QkQsUUFBUSxLQUFLQSxRQUFRLE1BQUtBLFFBQVEsSUFBSTtJQUN0QyxJQUFJRSxNQUFNTixLQUFLTyxPQUFPO0lBQ3RCRCxNQUFNLEtBQUtBLE1BQU0sTUFBS0EsTUFBTSxJQUFJO0lBQ2hDLElBQUlFLE9BQU9SLEtBQUtTLFFBQVE7SUFDeEJELE9BQU8sS0FBS0EsT0FBTyxNQUFLQSxPQUFPLElBQUk7SUFDbkMsSUFBSUUsU0FBU1YsS0FBS1csVUFBVTtJQUM1QkQsU0FBUyxLQUFLQSxTQUFTLE1BQU1BLFNBQVMsSUFBSTtJQUMxQyxJQUFJRSxTQUFTWixLQUFLYSxVQUFVO0lBQzVCRCxTQUFTLEtBQUtBLFNBQVMsTUFBTUEsU0FBUyxJQUFJO0lBRTFDLE9BQU9iLEtBQUtlLE1BQU07UUFDaEIsS0FBSztZQUNILE9BQU9aLE9BQU8sTUFBTUUsUUFBUSxNQUFNRTtRQUNwQyxLQUFLO1lBQ0gsT0FBT0UsT0FBTyxNQUFNRTtRQUN0QixLQUFLO1lBQ0gsT0FBT0Y7UUFDVCxLQUFLO1lBQ0gsT0FBT04sT0FBTyxNQUFNRSxRQUFRLE1BQU1FO1FBQ3BDLEtBQUs7WUFDSCxPQUFPSixPQUFLRSxRQUFNRTtRQUNwQixLQUFLO1lBQ0gsT0FBT0osT0FBS0UsUUFBTUU7UUFDcEI7WUFDRSxPQUFPSixPQUFPLE1BQU1FLFFBQVEsTUFBTUUsTUFBTSxNQUFNRSxPQUFPLE1BQU1FLFNBQVMsTUFBTUU7SUFDOUU7QUFDRixFQUFFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vam9vdG9uZy8uL3V0aWxzL2dldFRpbWUuanM/OGFlZiJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgY29uc3QgZ2V0VGltZSA9IChkYXRhID0ge30pID0+IHtcclxuXHJcbiAgbGV0IGRhdGUgPSBkYXRhLmRhdGVcclxuICBpZighZGF0ZSl7XHJcbiAgICBkYXRlID0gbmV3IERhdGUoKTtcclxuICB9ZWxzZXtcclxuICAgIGRhdGUgPSBuZXcgRGF0ZShkYXRhLmRhdGUpO1xyXG4gIH1cclxuXHJcbiAgbGV0IHllYXIgPSBkYXRlLmdldEZ1bGxZZWFyKCk7XHJcbiAgbGV0IG1vbnRoID0gZGF0ZS5nZXRNb250aCgpICsgMTtcclxuICBtb250aCA8IDEwID8gbW9udGggPSAnMCcrIG1vbnRoIDogbnVsbDtcclxuICBsZXQgZGF5ID0gZGF0ZS5nZXREYXRlKCk7XHJcbiAgZGF5IDwgMTAgPyBkYXkgPSAnMCcrIGRheSA6IG51bGw7XHJcbiAgbGV0IGhvdXIgPSBkYXRlLmdldEhvdXJzKCk7XHJcbiAgaG91ciA8IDEwID8gaG91ciA9ICcwJysgaG91ciA6IG51bGw7XHJcbiAgbGV0IG1pbnV0ZSA9IGRhdGUuZ2V0TWludXRlcygpO1xyXG4gIG1pbnV0ZSA8IDEwID8gbWludXRlID0gJzAnICsgbWludXRlIDogbnVsbDtcclxuICBsZXQgc2Vjb25kID0gZGF0ZS5nZXRTZWNvbmRzKCk7XHJcbiAgc2Vjb25kIDwgMTAgPyBzZWNvbmQgPSAnMCcgKyBzZWNvbmQgOiBudWxsO1xyXG5cclxuICBzd2l0Y2goZGF0YS5mb3JtYXQpe1xyXG4gICAgY2FzZSBcIllZWVkvTU0vRERcIiA6XHJcbiAgICAgIHJldHVybiB5ZWFyICsgJy8nICsgbW9udGggKyAnLycgKyBkYXk7XHJcbiAgICBjYXNlIFwiSEg6bW1cIiA6XHJcbiAgICAgIHJldHVybiBob3VyICsgJzonICsgbWludXRlO1xyXG4gICAgY2FzZSBcIkhIXCIgOlxyXG4gICAgICByZXR1cm4gaG91cjtcclxuICAgIGNhc2UgXCJZWVlZLCBNTSwgRERcIjpcclxuICAgICAgcmV0dXJuIHllYXIgKyAnLCcgKyBtb250aCArICcsJyArIGRheTtcclxuICAgIGNhc2UgXCJZWVlZTU1ERFwiOlxyXG4gICAgICByZXR1cm4geWVhcittb250aCtkYXk7XHJcbiAgICBjYXNlIFwiWVlZWS1NTS1ERFwiOlxyXG4gICAgICByZXR1cm4geWVhci1tb250aC1kYXk7XHJcbiAgICBkZWZhdWx0IDpcclxuICAgICAgcmV0dXJuIHllYXIgKyAnLycgKyBtb250aCArICcvJyArIGRheSArICcgJyArIGhvdXIgKyAnOicgKyBtaW51dGUgKyBcIjpcIiArIHNlY29uZDtcclxuICB9XHJcbn07XHJcbiJdLCJuYW1lcyI6WyJnZXRUaW1lIiwiZGF0YSIsImRhdGUiLCJEYXRlIiwieWVhciIsImdldEZ1bGxZZWFyIiwibW9udGgiLCJnZXRNb250aCIsImRheSIsImdldERhdGUiLCJob3VyIiwiZ2V0SG91cnMiLCJtaW51dGUiLCJnZXRNaW51dGVzIiwic2Vjb25kIiwiZ2V0U2Vjb25kcyIsImZvcm1hdCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./utils/getTime.js\n");

/***/ }),

/***/ "(api)/./utils/randomUUID.js":
/*!*****************************!*\
  !*** ./utils/randomUUID.js ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"randomUUID\": () => (/* binding */ randomUUID)\n/* harmony export */ });\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! crypto */ \"crypto\");\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(crypto__WEBPACK_IMPORTED_MODULE_0__);\n\nconst randomUUID = function(byte) {\n    return (new Date().getTime().toString(36).replace(\".\", \"\").substring(5, 7) + crypto__WEBPACK_IMPORTED_MODULE_0___default().randomBytes(byte || 4).toString(\"hex\")).toUpperCase();\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi91dGlscy9yYW5kb21VVUlELmpzLmpzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUE0QjtBQUVyQixNQUFNQyxhQUFhLFNBQVNDLElBQUksRUFBQztJQUN0QyxPQUFPLENBQUMsSUFBS0MsT0FBT0MsT0FBTyxHQUFJQyxRQUFRLENBQUMsSUFBSUMsT0FBTyxDQUFDLEtBQUssSUFBSUMsU0FBUyxDQUFDLEdBQUcsS0FBS1AseURBQWtCLENBQUNFLFFBQVEsR0FBR0csUUFBUSxDQUFDLE1BQUssRUFBR0ksV0FBVztBQUMzSSxFQUFDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vam9vdG9uZy8uL3V0aWxzL3JhbmRvbVVVSUQuanM/ZjY0OCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgY3J5cHRvIGZyb20gJ2NyeXB0byc7XHJcblxyXG5leHBvcnQgY29uc3QgcmFuZG9tVVVJRCA9IGZ1bmN0aW9uKGJ5dGUpe1xyXG4gIHJldHVybiAoKG5ldyBEYXRlKCkuZ2V0VGltZSgpKS50b1N0cmluZygzNikucmVwbGFjZShcIi5cIiwgXCJcIikuc3Vic3RyaW5nKDUsIDcpICsgY3J5cHRvLnJhbmRvbUJ5dGVzKGJ5dGUgfHwgNCkudG9TdHJpbmcoJ2hleCcpKS50b1VwcGVyQ2FzZSgpO1xyXG59ICJdLCJuYW1lcyI6WyJjcnlwdG8iLCJyYW5kb21VVUlEIiwiYnl0ZSIsIkRhdGUiLCJnZXRUaW1lIiwidG9TdHJpbmciLCJyZXBsYWNlIiwic3Vic3RyaW5nIiwicmFuZG9tQnl0ZXMiLCJ0b1VwcGVyQ2FzZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./utils/randomUUID.js\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = (__webpack_exec__("(api)/./pages/api/message/websocket.js"));
module.exports = __webpack_exports__;

})();