(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[191],{8892:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admy",function(){return t(9626)}])},9626:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return x}});var s=t(5893),a=t(6931),i=t.n(a),r=t(9598),o=t(7294),l=t(3299),c=t(4480),d=t(338),u=t(1163),m=t(5486),_=t(2932),h=t(123);function x(){let e=(0,c.sJ)(d.EA);(0,u.useRouter)();let[n,t]=(0,o.useState)({isAlert:!1,message:"",confirm:(0,s.jsx)("button",{}),cancel:(0,s.jsx)("button",{})}),[a,x]=(0,o.useState)(0),[p,g]=(0,o.useState)([]),[j,f]=(0,o.useState)([]),[w,k]=(0,o.useState)([]),[N,b]=(0,o.useState)(1),v=(0,o.useRef)({title:"",content:"",idx:""}),y=(0,o.useRef)({email:"",password:"",nickname:""});(0,o.useRef)({email:"",password:""});let[C,E]=(0,o.useState)(!1),[T,A]=(0,o.useState)(!1),S=function(e){e.preventDefault(),(0,l.signIn)("credentials",{email:y.current.email,password:y.current.password,callbackUrl:window.location.href,redirect:!1}).then(async e=>{let{ok:n,error:t}=e,s=await (0,l.getSession)();console.log(n,null==s?void 0:s.user.user_key),n&&s?(setLoading(!1),E(!0),O(),Z(),I(),R()):console.log("error :",t)}).catch(e=>{console.log(e)})};function O(){fetch("/api/user",{method:"GET"}).then(e=>e.json()).then(async e=>{e.status&&(console.log("getTotalMember",e),x(e.data))})}function Z(){fetch("/api/room?page=all",{method:"GET"}).then(e=>e.json()).then(e=>{if(e.status){console.log("getTotalRoom",e);let n=e.data,t="";for(let s=0;s<n.length;s++)t+=n[s].room_id+"|";(t=t.slice(0,-1))?fetch("/api/message?roomIds="+t,{method:"GET"}).then(e=>e.json()).then(e=>{let t=e.data,s={},a={};for(let i in t.forEach(e=>{s[e.room_id]||(s[e.room_id]=[]),s[e.room_id].push(e)}),s)if(s.hasOwnProperty(i)){a[i]||(a[i]={count:s[i].length,use_image:!1,person:0});let r=s[i].filter((e,n,t)=>n===t.findIndex(n=>n.user_key===e.user_key));a[i].person=r.length;for(let o=0;o<s[i].length;o++)if(s[i][o].image){a[i].use_image=!0;break}}for(let l=0;l<n.length;l++)n[l].use_image=a[n[l].room_id].use_image,n[l].reply=a[n[l].room_id].count,n[l].person=a[n[l].room_id].person;g(n)}):g([])}})}function I(){fetch("/api/message?all=true",{method:"GET"}).then(e=>e.json()).then(e=>{e.status&&(console.log("getTotalmessage",e),f(e.data))})}function R(){fetch("/api/support?all=true",{method:"GET"}).then(e=>e.json()).then(async e=>{e.status&&(console.log("supportList",e),k(e.data))})}return(0,o.useEffect)(()=>{("8N2885B0883C"===e.user_key||"XFD84427C21D"===e.user_key||"O3E995E25F27"===e.user_key)&&(E(!0),O(),Z(),I(),R())},[e]),(0,s.jsxs)("div",{className:i().wrap,children:[(0,s.jsx)(r.Z,{}),C?(0,s.jsxs)("div",{className:i().inner,children:[(0,s.jsx)("div",{className:i().admin_status,children:(0,s.jsxs)("div",{className:i().nickname_change,children:[(0,s.jsx)("input",{onChange:e=>{y.current.nickname=e.target.value}}),(0,s.jsx)("button",{onClick:()=>{!function(){if(""===y.current.nickname)return;let e={newNickname:y.current.nickname,nickname:session.user.nickname,user_key:session.user.user_key};fetch("/api/user?target=nickname",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(e=>e.json()).then(async e=>{console.log(e),e.status?(session.user.nickname=e.nickname,await update({...session,user:{...null==session?void 0:session.user,nickname:e.nickname}}),t({isAlert:!0,message:(0,s.jsxs)("span",{children:["닉네임 [",e.nickname,"] 으로 변경 되었습니다."]}),confirm:(0,s.jsx)("button",{onClick:()=>{t({isAlert:!1})},children:"확인"})})):t({isAlert:!0,message:(0,s.jsxs)("span",{children:["[",e.message,"] "]}),confirm:(0,s.jsx)("button",{onClick:()=>{t({isAlert:!1})},children:"확인"})})})}()},children:"변경"})]})}),(0,s.jsxs)("div",{className:i().total_member,children:[(0,s.jsx)("div",{children:(0,s.jsx)("h2",{children:"전체 회원"})}),"회원 수 : ",a," ",(0,s.jsx)("br",{}),"접속 수 : ",N]}),(0,s.jsxs)("div",{className:i().total_room,children:[(0,s.jsx)("h2",{children:"전체 방"}),(0,s.jsx)("div",{className:i().total_list,children:p.length?p.map(e=>(0,s.jsx)(Room,{room:e},e.create_date)):(0,s.jsx)("div",{className:i().empty,children:"검색 결과가 없습니다."})})]}),(0,s.jsxs)("div",{className:i().total_message,children:[(0,s.jsx)("h2",{children:"메시지"}),(0,s.jsx)("ul",{className:i().total_list,children:j.length?j.map(e=>(0,s.jsxs)("li",{onClick:()=>{(0,h.x)("/room/"+e.room_id)},children:[(0,s.jsx)("span",{className:i().room_id,children:e.room_id}),(0,s.jsx)("span",{className:i().message,children:e.text})]},(new Date(e.send_date)+Math.random()).toString(36))):(0,s.jsx)("li",{className:i().empty,children:"검색 결과가 없습니다."})})]}),(0,s.jsxs)("div",{className:i().total_support,children:[(0,s.jsx)("h2",{children:"문의"}),(0,s.jsx)("ul",{className:i().list,children:w.length?w.map(e=>(0,s.jsxs)("li",{className:i().list_data,children:[(0,s.jsxs)("div",{className:i().meta,children:[(0,s.jsxs)("div",{children:["날짜:",(0,_.getDateDiff)(e.create_date).text,e.answer&&(0,s.jsx)("span",{className:i().answer_status,children:"[답변완료]"})]}),(0,s.jsxs)("div",{children:["제목:",e.title]}),(0,s.jsxs)("div",{className:i().inquiry,children:["문의 내용",(0,s.jsx)("pre",{children:e.content})]}),e.answer&&(0,s.jsxs)("div",{className:i().answer,children:["답변 내용",(0,s.jsx)("pre",{children:e.answer})]})]}),(0,s.jsx)("button",{className:i().answer_button,onClick:()=>{v.current.title=e.title,v.current.idx=e.idx,A(!T)},children:"답변쓰기"}),T&&(0,s.jsxs)("div",{className:i().answer_create,children:[(0,s.jsx)("textarea",{onChange:e=>v.current.content=e.target.value,placeholder:"친절하게 답변을 작성해 주세요."}),(0,s.jsxs)("div",{className:i().button_box,children:[(0,s.jsx)("button",{className:i().confirm,onClick:()=>(function(){if(""===v.current.content)return t({isAlert:!0,message:(0,s.jsx)("span",{children:"답변 내용을 입력 해주세요."}),confirm:(0,s.jsx)("button",{onClick:()=>{t({isAlert:!1})},children:"확인"})}),!1;console.log(v.current),fetch("/api/support",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(v.current)}).then(e=>e.json()).then(async e=>{if(e.status){let n=w;for(let a=0;a<n.length;a++)n[a].idx===v.current.idx&&(console.log("support data",n[a],v),n[a].answer=v.current.content);k(n),t({isAlert:!0,message:(0,s.jsx)("span",{children:"답변이 완료 되었습니다."}),confirm:(0,s.jsx)("button",{onClick:()=>{t({isAlert:!1}),v.current.title="",A(!1)},children:"확인"})})}})})(),children:"완료"}),(0,s.jsx)("button",{onClick:()=>{v.current.title="",A(!T)},children:"취소"})]})]})]},e.create_date)):(0,s.jsx)("li",{className:i().empty,children:"검색 결과가 없습니다."})})]})]}):(0,s.jsx)("div",{className:i().admin_login,children:(0,s.jsxs)("form",{children:[(0,s.jsxs)("label",{children:["아이디",(0,s.jsx)("input",{type:"text",maxLength:50,onChange:e=>{y.current.email=e.target.value}})]}),(0,s.jsxs)("label",{children:["비밀번호",(0,s.jsx)("input",{type:"password",maxLength:14,onChange:e=>{y.current.password=e.target.value}})]}),(0,s.jsx)("button",{className:i().provider,onClick:e=>S(e),children:"로그인"})]})}),n.isAlert&&(0,s.jsx)(m.Z,{props:{message:(0,s.jsx)("span",{children:n.message}),confirm:n.confirm,cancel:n.cancel}})]})}},123:function(e,n,t){"use strict";t.d(n,{x:function(){return s}});let s=function(e,n,t){var s,a,i,r;let o=null!==(a=null!==(s=window.innerWidth)&&void 0!==s?s:document.documentElement.clientWidth)&&void 0!==a?a:screen.width,l=null!==(r=null!==(i=window.innerHeight)&&void 0!==i?i:document.documentElement.clientHeight)&&void 0!==r?r:screen.height,c=window.screenX+(window.outerWidth-o)/2,d=window.screenY+(window.outerHeight-l)/2,u=window.open(e,"_blank","width=".concat(500,",height=",700,",left=").concat(c,",top=").concat(d));return null==u||u.focus(),u}},6931:function(e){e.exports={wrap:"admin_wrap__8jhkt",admin_login:"admin_admin_login__ZqsPI",inner:"admin_inner__uZ_D_",admin_status:"admin_admin_status__2BIIN",nickname_change:"admin_nickname_change__LROs8",total_room:"admin_total_room__MEWa2",total_list:"admin_total_list___bqx_",total_message:"admin_total_message__L0Q3x",total_support:"admin_total_support__piGc7",list_data:"admin_list_data__UMbNN",meta:"admin_meta__Z_6fB",answer_status:"admin_answer_status__iBqIT",inquiry:"admin_inquiry__dIXcO",answer:"admin_answer__UZ70Z",answer_button:"admin_answer_button__kARHs",answer_create:"admin_answer_create__ZnEyE",button_box:"admin_button_box__6VZn_",confirm:"admin_confirm__CPlOL"}}},function(e){e.O(0,[664,685,598,774,888,179],function(){return e(e.s=8892)}),_N_E=e.O()}]);